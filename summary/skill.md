---
name: summary
description: 将当前对话的精华内容提取并保存到 Obsidian。触发条件：用户说 "/summary"、"保存对话"、"导出精华"、"沉淀到 Obsidian" 等，或明确要求将对话内容保存到笔记软件时使用。
---

# Claude Code 对话精华提取器

## 目标
将当前对话的精华内容自动提取、结构化，并保存到 Obsidian 指定文件夹中。

## 精华判断标准

### 需要提取的内容
- **问题与解决**: 具体的问题描述和解决方案
- **代码片段**: 可复用的代码、配置、命令
- **决策原因**: 技术选型的理由、权衡取舍
- **新知识**: 之前不知道的信息、API 坑点、最佳实践
- **错误教训**: 踩过的坑、为什么失败

### 应过滤的内容
- 纯对话过渡："好的"、"明白了"、"试试看"
- 中间调试输出：临时打印的日志
- 最终没用的失败尝试

## 工作流程

### 第一步：分析对话
1. 阅读当前对话的全部内容
2. 识别对话的核心主题
3. 提取精华内容（按上述标准）

### 第二步：生成笔记结构
```markdown
## 背景
<简述对话背景和问题>

## 核心内容
<主要讨论内容>

## 解决方案
<如果有，列出解决方案>

\`\`\`language
<代码片段>
\`\`\`

## 关键要点
- 要点1
- 要点2

## 相关
- 项目路径: <当前工作目录>
- 相关技术/工具
```

**重要**:
- **不要 YAML frontmatter**（不包含 tags、date 等元数据）
- **不要 H1 标题**（文件名即为主题，内容直接从 H2 开始）
- 保持内容简洁，直接进入主题

### 第三步：保存到 Obsidian

**使用 Bash 工具直接写入文件**，无需 MCP 连接：

```bash
# 构建完整文件路径（假设 Obsidian vault 在 E:/obsidian）
OBSDIR="E:/obsidian/Claude Code对话精华内容"
FILENAME="<对话主题标题>.md"
FULLPATH="$OBSDIR/$FILENAME"

# 使用 heredoc 语法写入内容
cat > "$FULLPATH" << 'EOF'
## 背景
<简述对话背景和问题>

## 核心内容
<主要讨论内容>

## 解决方案
<如果有，列出解决方案>

\`\`\`language
<代码片段>
\`\`\`

## 关键要点
- 要点1
- 要点2

## 相关
- 项目路径: <当前工作目录>
- 相关技术/工具
EOF
```

**注意**：
- 使用 `<< 'EOF'` （单引号）确保内容中的特殊字符不会被转义
- 文件路径使用双引号包裹，处理空格
- 一次性完成保存，无需二次确认

## 注意事项

1. **文件名生成规则**:
   - 从对话中提取核心主题作为文件名
   - 保持简洁，使用中文或英文
   - 避免特殊字符（如 `/` `\` `:` `*` `?` `<` `>` `|`）
   - 如果主题不明显，使用日期+序号格式（如 `2024-02-01-01.md`）

2. **内容质量**:
   - 确保笔记独立可读（有上下文）
   - 代码片段要有语言标识
   - 关键信息不遗漏

3. **Obsidian 路径配置**:
   - 默认路径：`E:/obsidian/Claude Code对话精华内容/`
   - 如果你的 vault 在其他位置，修改 `OBSDIR` 变量
   - 确保目录存在，如不存在先创建：`mkdir -p "$OBSDIR"`

4. **Windows 路径处理**:
   - 使用正斜杠 `/` 或双反斜杠 `\\`
   - 避免使用单反斜杠 `\`（会被转义）

## 工具使用

- **Bash 工具**: 执行 shell 命令直接写入文件
- **cat 命令 + heredoc**: 创建包含多行内容的文件
- **mkdir 命令**: 创建目录（如果不存在）

